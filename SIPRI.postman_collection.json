{
  "info": {
    "_postman_id": "sipri-api-collection-2024",
    "name": "SIPRI - Sistema de Investimentos",
    "description": "Cole√ß√£o completa da API SIPRI com autentica√ß√£o Keycloak configurada.\n\n## Como usar:\n1. Configure as vari√°veis de ambiente (j√° pr√©-configuradas)\n2. Execute a requisi√ß√£o de autentica√ß√£o desejada (Web Client ou Service Client)\n3. O token ser√° automaticamente salvo e usado nas demais requisi√ß√µes\n4. Teste os endpoints dispon√≠veis",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "auth": {
    "type": "bearer",
    "bearer": [
      {
        "key": "token",
        "value": "{{access_token}}",
        "type": "string"
      }
    ]
  },
  "item": [
    {
      "name": "üîê Autentica√ß√£o",
      "item": [
        {
          "name": "1Ô∏è‚É£ Obter Token - Cliente Web (PKCE)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// Salva o token automaticamente",
                  "if (pm.response.code === 200) {",
                  "    var jsonData = pm.response.json();",
                  "    pm.collectionVariables.set(\"access_token\", jsonData.access_token);",
                  "    pm.collectionVariables.set(\"refresh_token\", jsonData.refresh_token);",
                  "    console.log(\"‚úÖ Token obtido com sucesso!\");",
                  "    console.log(\"Token expira em: \" + jsonData.expires_in + \" segundos\");",
                  "} else {",
                  "    console.log(\"‚ùå Erro ao obter token\");",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/x-www-form-urlencoded"
              }
            ],
            "body": {
              "mode": "urlencoded",
              "urlencoded": [
                {
                  "key": "client_id",
                  "value": "cli-web-sipri",
                  "description": "Cliente p√∫blico (Web/SPA)",
                  "type": "text"
                },
                {
                  "key": "grant_type",
                  "value": "password",
                  "description": "Resource Owner Password Credentials (apenas para testes)",
                  "type": "text"
                },
                {
                  "key": "username",
                  "value": "user",
                  "description": "Usu√°rio padr√£o",
                  "type": "text"
                },
                {
                  "key": "password",
                  "value": "user",
                  "description": "Senha padr√£o",
                  "type": "text"
                },
                {
                  "key": "scope",
                  "value": "openid profile email",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "{{keycloak_url}}/realms/{{realm}}/protocol/openid-connect/token",
              "host": ["{{keycloak_url}}"],
              "path": [
                "realms",
                "{{realm}}",
                "protocol",
                "openid-connect",
                "token"
              ]
            },
            "description": "Obt√©m token JWT usando cliente p√∫blico (cli-web-sipri).\n\n**Credenciais padr√£o:**\n- Username: `user`\n- Password: `user`\n\nO token ser√° automaticamente salvo na vari√°vel `access_token` e usado nas pr√≥ximas requisi√ß√µes."
          },
          "response": []
        },
        {
          "name": "2Ô∏è‚É£ Obter Token - Cliente de Servi√ßo (Client Credentials)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// Salva o token automaticamente",
                  "if (pm.response.code === 200) {",
                  "    var jsonData = pm.response.json();",
                  "    pm.collectionVariables.set(\"access_token\", jsonData.access_token);",
                  "    console.log(\"‚úÖ Token de servi√ßo obtido com sucesso!\");",
                  "    console.log(\"Token expira em: \" + jsonData.expires_in + \" segundos\");",
                  "} else {",
                  "    console.log(\"‚ùå Erro ao obter token de servi√ßo\");",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/x-www-form-urlencoded"
              }
            ],
            "body": {
              "mode": "urlencoded",
              "urlencoded": [
                {
                  "key": "client_id",
                  "value": "cli-sir-sipri",
                  "description": "Cliente confidencial (Backend/Service)",
                  "type": "text"
                },
                {
                  "key": "client_secret",
                  "value": "{{client_secret}}",
                  "description": "Secret do cliente de servi√ßo",
                  "type": "text"
                },
                {
                  "key": "grant_type",
                  "value": "client_credentials",
                  "type": "text"
                },
                {
                  "key": "scope",
                  "value": "openid",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "{{keycloak_url}}/realms/{{realm}}/protocol/openid-connect/token",
              "host": ["{{keycloak_url}}"],
              "path": [
                "realms",
                "{{realm}}",
                "protocol",
                "openid-connect",
                "token"
              ]
            },
            "description": "Obt√©m token JWT usando cliente confidencial (cli-sir-sipri) com Client Credentials.\n\nEste fluxo √© usado para comunica√ß√£o service-to-service, sem usu√°rio final.\n\nO token ser√° automaticamente salvo na vari√°vel `access_token`."
          },
          "response": []
        },
        {
          "name": "3Ô∏è‚É£ Renovar Token (Refresh)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    var jsonData = pm.response.json();",
                  "    pm.collectionVariables.set(\"access_token\", jsonData.access_token);",
                  "    pm.collectionVariables.set(\"refresh_token\", jsonData.refresh_token);",
                  "    console.log(\"‚úÖ Token renovado com sucesso!\");",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "urlencoded",
              "urlencoded": [
                {
                  "key": "client_id",
                  "value": "cli-web-sipri",
                  "type": "text"
                },
                {
                  "key": "grant_type",
                  "value": "refresh_token",
                  "type": "text"
                },
                {
                  "key": "refresh_token",
                  "value": "{{refresh_token}}",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "{{keycloak_url}}/realms/{{realm}}/protocol/openid-connect/token",
              "host": ["{{keycloak_url}}"],
              "path": [
                "realms",
                "{{realm}}",
                "protocol",
                "openid-connect",
                "token"
              ]
            },
            "description": "Renova o access token usando o refresh token."
          },
          "response": []
        }
      ],
      "description": "Endpoints de autentica√ß√£o OAuth2/OIDC com Keycloak.\n\n**Dois tipos de clientes dispon√≠veis:**\n1. **cli-web-sipri** - Cliente p√∫blico (Web/SPA)\n2. **cli-sir-sipri** - Cliente confidencial (Backend/Service)"
    },
    {
      "name": "üí∞ Simula√ß√µes",
      "item": [
        {
          "name": "Simular Investimento",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"clienteId\": \"123e4567-e89b-12d3-a456-426614174000\",\n  \"produtoId\": 1,\n  \"valorInicial\": 10000.00,\n  \"prazoMeses\": 12\n}"
            },
            "url": {
              "raw": "{{api_url}}/api/simulacoes/simular",
              "host": ["{{api_url}}"],
              "path": ["api", "simulacoes", "simular"]
            },
            "description": "Simula um investimento calculando rentabilidade esperada.\n\n**Exemplo de entrada:**\n```json\n{\n  \"clienteId\": \"123e4567-e89b-12d3-a456-426614174000\",\n  \"produtoId\": 1,\n  \"valorInicial\": 10000.00,\n  \"prazoMeses\": 12\n}\n```"
          },
          "response": []
        },
        {
          "name": "Listar Simula√ß√µes do Cliente",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{api_url}}/api/simulacoes?clienteId=123e4567-e89b-12d3-a456-426614174000",
              "host": ["{{api_url}}"],
              "path": ["api", "simulacoes"],
              "query": [
                {
                  "key": "clienteId",
                  "value": "123e4567-e89b-12d3-a456-426614174000",
                  "description": "ID do cliente (GUID)"
                }
              ]
            },
            "description": "Lista todas as simula√ß√µes realizadas por um cliente."
          },
          "response": []
        },
        {
          "name": "Obter Simula√ß√µes Agregadas",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{api_url}}/api/simulacoes/agregadas?clienteId=123e4567-e89b-12d3-a456-426614174000",
              "host": ["{{api_url}}"],
              "path": ["api", "simulacoes", "agregadas"],
              "query": [
                {
                  "key": "clienteId",
                  "value": "123e4567-e89b-12d3-a456-426614174000"
                }
              ]
            },
            "description": "Retorna dados agregados das simula√ß√µes do cliente."
          },
          "response": []
        }
      ],
      "description": "Endpoints para simula√ß√£o de investimentos."
    },
    {
      "name": "üë§ Perfil de Risco",
      "item": [
        {
          "name": "Calcular Perfil de Risco",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{api_url}}/api/perfil/123e4567-e89b-12d3-a456-426614174000",
              "host": ["{{api_url}}"],
              "path": ["api", "perfil", "123e4567-e89b-12d3-a456-426614174000"]
            },
            "description": "Calcula o perfil de risco do cliente baseado em seus investimentos e comportamento.\n\n**Perfis poss√≠veis:**\n- Conservador\n- Moderado\n- Arrojado"
          },
          "response": []
        },
        {
          "name": "Obter Produtos Recomendados",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{api_url}}/api/perfil/produtos-recomendados/Moderado",
              "host": ["{{api_url}}"],
              "path": ["api", "perfil", "produtos-recomendados", "Moderado"]
            },
            "description": "Lista produtos de investimento recomendados para um perfil espec√≠fico.\n\n**Perfis v√°lidos:**\n- Conservador\n- Moderado\n- Arrojado"
          },
          "response": []
        }
      ],
      "description": "Endpoints para c√°lculo de perfil de risco e recomenda√ß√µes."
    },
    {
      "name": "üìä Investimentos",
      "item": [
        {
          "name": "Listar Investimentos do Cliente",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{api_url}}/api/investimentos/123e4567-e89b-12d3-a456-426614174000",
              "host": ["{{api_url}}"],
              "path": [
                "api",
                "investimentos",
                "123e4567-e89b-12d3-a456-426614174000"
              ]
            },
            "description": "Retorna a carteira completa de investimentos do cliente."
          },
          "response": []
        }
      ],
      "description": "Endpoints para gest√£o de investimentos."
    },
    {
      "name": "üìà Telemetria",
      "item": [
        {
          "name": "Obter M√©tricas da API",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{api_url}}/api/telemetria",
              "host": ["{{api_url}}"],
              "path": ["api", "telemetria"]
            },
            "description": "Retorna m√©tricas agregadas da API:\n- Total de simula√ß√µes\n- Total de investimentos\n- Valor total investido\n- Distribui√ß√£o por perfil de risco"
          },
          "response": []
        }
      ],
      "description": "Endpoints de telemetria e m√©tricas."
    }
  ],
  "variable": [
    {
      "key": "api_url",
      "value": "http://localhost:5058",
      "type": "string"
    },
    {
      "key": "keycloak_url",
      "value": "http://localhost:8080",
      "type": "string"
    },
    {
      "key": "realm",
      "value": "sipri-realm",
      "type": "string"
    },
    {
      "key": "client_secret",
      "value": "Z3T3Jz3QWZ1Hdb0TpyW8JTKXytnmAylR",
      "type": "string",
      "description": "Secret do cliente cli-sir-sipri (j√° pr√©-configurado)"
    },
    {
      "key": "access_token",
      "value": "",
      "type": "string",
      "description": "Token JWT (preenchido automaticamente ap√≥s autentica√ß√£o)"
    },
    {
      "key": "refresh_token",
      "value": "",
      "type": "string",
      "description": "Refresh token (preenchido automaticamente)"
    }
  ]
}
